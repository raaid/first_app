<link rel="stylesheet" media="screen" type="text/css" href="stylesheets/spectrum.css" />
<style>p{color:#000}</style>

<section>
  <div class="container">
<h1>Tools</h1>
<br/>

<%if @user.try(:approve) == 1%>

  <center><input type="button" onclick="$('#createbtn').slideToggle(900)" value="Create Affiliate Button" class="btn btn-success" style="width:200px" /></center>

  <div id="createbtn" style="margin-top:15px;display:none">
    <div style="border:solid #000; border-radius:10px;position:relative;width:350px;height:200px;padding:10px;left:50%;margin-left:-175px" id="previewContainer">
  	  <span id="affButton" onclick="window.open('<%=root_url%>?aff=<%=@user.id%>')" style="cursor:pointer;width:122px;height:93px;position:absolute;left:50%;margin-left:-61px;top:0;font-size:13pt;background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+CiAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjNGM0YzRjIiBzdG9wLW9wYWNpdHk9IjEiLz4KICAgIDxzdG9wIG9mZnNldD0iMTIlIiBzdG9wLWNvbG9yPSIjNTk1OTU5IiBzdG9wLW9wYWNpdHk9IjEiLz4KICAgIDxzdG9wIG9mZnNldD0iMjUlIiBzdG9wLWNvbG9yPSIjNjY2NjY2IiBzdG9wLW9wYWNpdHk9IjEiLz4KICAgIDxzdG9wIG9mZnNldD0iMzklIiBzdG9wLWNvbG9yPSIjNDc0NzQ3IiBzdG9wLW9wYWNpdHk9IjEiLz4KICAgIDxzdG9wIG9mZnNldD0iNTAlIiBzdG9wLWNvbG9yPSIjMmMyYzJjIiBzdG9wLW9wYWNpdHk9IjEiLz4KICAgIDxzdG9wIG9mZnNldD0iNzYlIiBzdG9wLWNvbG9yPSIjMmIyYjJiIiBzdG9wLW9wYWNpdHk9IjEiLz4KICAgIDxzdG9wIG9mZnNldD0iOTElIiBzdG9wLWNvbG9yPSIjMWMxYzFjIiBzdG9wLW9wYWNpdHk9IjEiLz4KICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzEzMTMxMyIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgPC9saW5lYXJHcmFkaWVudD4KICA8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMSIgaGVpZ2h0PSIxIiBmaWxsPSJ1cmwoI2dyYWQtdWNnZy1nZW5lcmF0ZWQpIiAvPgo8L3N2Zz4=);font-weight:bold;color:#fff;text-align:center;border-radius:10px">
    	 <img style="width:100px" src='https://s3.amazonaws.com/storage.production.ticketacular.me/eventastic_logo.png' /><br>
    	 <span>Create Event</span>
  	  </span>
    </div>
    <center>

      <p>Select the position you would like the feature button to appear on your screen. Once you make your selection a feature button will be rendered on this screen so you can preview what it will look like on your own page.</p>

      <span onclick="moveButton('left')" class="btn btn-primary" style="width:150px;">
        <i class="icon-circle-arrow-left icon-white"></i>
        <span>Left</span>
      </span>
      <span onclick="moveButton('right')" class="btn btn-primary" style="width:150px;">
        <i class="icon-circle-arrow-right icon-white"></i>
        <span>Right</span>
      </span>
      <span onclick="moveButton('top')" class="btn btn-primary" style="width:150px;">
        <i class="icon-circle-arrow-up icon-white"></i>
        <span>Top</span>
      </span>
      <span onclick="moveButton('bottom')" class="btn btn-primary" style="width:150px;">
        <i class="icon-circle-arrow-down icon-white"></i>
        <span>Bottom</span>
      </span>

      <br><br>

      <span onclick="setPosition('fixed')" class="btn btn-primary" style="width:150px;">
        <img style="width:20px" src='/images/lock.png' />
        <span>Lock On Screen</span>
      </span>
      <span onclick="setPosition('absolute')" class="btn btn-primary" style="width:150px;">
        <img style="width:20px" src='/images/unlock.png' />
        <span>Unlock On Screen</span>
      </span>
      <br><br>

      <p>Copy and paste the following code into your website to generate your referral feature button:</p>
      <textarea id="area" style="width:750px;height:400px;"></textarea>
    </center>
  </div>

  <center><input type="button" onclick="$('#createTicketWidget').slideToggle(900)" value="Create Ticket Widget" class="btn btn-success" style="width:200px;margin-top:10px" /></center>
  <center>

  <div id="createTicketWidget" style="display:none">
    <div id="ticket_widget" class="tic_widget" style="background:<%=@widget_profile.tickets_background%>">
      <div style="height:100%;width:100%;color:#000">
        <%= form_for(TicketInstance.new) do |f| %>
         <center>
    
           <table width="95%" >
             <tr style="margin:1px;">
                <td width="45%"><center><p><b>*Guest Name</b></p></center></td>
                <td width="10%"></td>
                <td width="45%"><center><p><b>*Guest Email</b></p></center></td>
             </tr>
             <tr>
                <td width="45%"><center><%= f.text_field :guest_name, :class=>"loginFormSize", :required=>true %></center></td>
                <td width="10%"></td>
                <td width="45%"><center><%= f.text_field :guest_email, :class=>"loginFormSize",:required=>true %></center></td>
             </tr>
           </table>
           <br />
         </center>
         <div >
          <center>
          
           <hr />
          <table width="85%">
            <tr style="margin:5px;">
              <td width="66%"><b>Name</b></td>
              <td width="20%"><b>Price</b></td>
              <td width="5%"></td>
              <td width="9%"><b>Quantity</b></td>
            </tr>
          </table>
          <table width="85%">

          <hr />

          <tr style="margin:3px;height:23px;">
            <td width="63%">Admission</td>
            <td width="18%">$10.00</td>
            <td width="10%"> X &nbsp;</td>
            <td width="9%"><input type="text" size="5" style="width:30px;" /></td>
          </tr>
          <tr style="margin:3px;height:23px;">
            <td width="63%">Raffle</td>
            <td width="18%">$2.00</td>
            <td width="10%"> X &nbsp;</td>
            <td width="9%"><input type="text" size="5" style="width:30px;" /></td>
          </tr>
       
          </table>
         </center>
         </div>
         <div class="actions">
          <br />
            <center>
              <%= image_tag "https://s3.amazonaws.com/storage.production.ticketacular.me/site_images/paypal2s.png"%>
              <center><p style="font-size: 8pt;">*All purchases are subject to Paypal processing fees</p></center>
              <br />
              <%= f.submit "Buy Tickets", :class=>"btn btn-success", id: "buyTickets", :style=>"width:250px;" %>
            </center>
         </div>
       </div>
   <% end %>
   

    </div>

    <div style="margin-top:15px">
      <label for="colourChooser" style="display:inline-block;margin-top:5px">Edit widget background colour &nbsp;</label>
      <input id="colourChooser" />
    </div>


    <select id="chooseEvent" style="margin-top:15px;width:300px" onchange="setCode(this.value)">
      <option value="">Select Event</option>
      <%= @events.each do |event| %>
        <option value='<%=event.id%>'><%=event.name%></option>
      <%end%>
    </select>

    <br>
    <p>Copy and paste the following code into your website to generate your tickets widget:</p>
    <textarea id="ticket_code" style="width:550px;height:20px;"></textarea>

  </center>

  <center><input type="button" onclick="$('#createEventWidget').slideToggle(900)" value="Create Events Widget" class="btn btn-success" style="width:200px;margin-top:10px" /></center>
  <center>
  <div id="createEventWidget" style="display:none">
    <div style="margin-top:15px">
      <label for="eventColour" style="display:inline-block;margin-top:5px">Edit widget background colour &nbsp;</label>
      <input id="eventColour" />
    </div>

    <div style="height:100%;width:100%;display:inline-block;">
    <%@events.each do |event|%>
      <div class="eventColourChange" style="padding:8px;border-radius:8px;border: solid 1px #fff;margin-top:5px;background-color:<%=@widget_profile.events_background%>;width:98%;color:#fff;font-size:17pt;height:35px;-webkit-box-shadow:rgba(0,0,0,0.6) 0 6px 15px;">
        <img src="<%=event.event_image.url(:feed)%>" style="height:35px;float:left"/>
        <div style="float:left;margin-left:10px"><%=event.name%></div>
        <div style="float:right"><%= event.startTime.strftime("%Y-%m-%d") %></div>
      </div>
    <%end%>
    <% if @events.length == 0 %>
      <div class="eventColourChange" style="padding:8px;border-radius:8px;border: solid 1px #fff;margin-top:5px;background-color:<%=@widget_profile.events_background%>;width:98%;color:#fff;font-size:17pt;height:35px;-webkit-box-shadow:rgba(0,0,0,0.6) 0 6px 15px;">
        <img src="/images/event_image/feed/missing.jpg" style="height:35px;float:left"/>
        <div style="float:left;margin-left:10px">Event Name</div>
        <div style="float:right"><%= Time.now.strftime("%Y-%m-%d") %></div>
      </div>
      <div class="eventColourChange" style="padding:8px;border-radius:8px;border: solid 1px #fff;margin-top:5px;background-color:<%=@widget_profile.events_background%>;width:98%;color:#fff;font-size:17pt;height:35px;-webkit-box-shadow:rgba(0,0,0,0.6) 0 6px 15px;">
        <img src="/images/event_image/feed/missing.jpg" style="height:35px;float:left"/>
        <div style="float:left;margin-left:10px">Another Event</div>
        <div style="float:right"><%= Time.now.strftime("%Y-%m-%d") %></div>
      </div>
    <%end%>
  </div>
  <br><br>
  
  <p>Copy and paste the following code into your website to generate your events widget:</p>
  <textarea style="width:550px;height:20px;">  <iframe src="http://eventastic.com/widget_users/<%=@user.id%>"></iframe></textarea>

</div>
</center>

<%else%>

<h1>This section will be unlocked once your affiliate application has been approved</h1>

<%end%>
    <br />
    <br />
</div></section>

<script type="text/javascript" src="/javascripts/spectrum.js"></script>

<script>

  $('#buyTickets').click(function(e) {
    e.preventDefault(); //prevents the default submit action
    $(this).closest('form').attr('target', '_blank').submit();
  });

  function setCode(event_id) {
    if (event_id) {
      document.getElementById("ticket_code").innerHTML = "<iframe src='http://eventastic.com/widget_tickets/" + event_id + "'></iframe>";
    } else {
      document.getElementById("ticket_code").innerHTML = "";
    }
  }

  function moveButton(location) {
    btn = document.getElementById("affButton");
    if (location == 'top' || location == "bottom") {
      btn.style.left = "50%";
      btn.style.marginLeft = "-61px";
      btn.style.top = "";
      btn.style.marginTop = "";
      if (location == 'top') {
        btn.style.top = "0";
      } else {
        btn.style.bottom = "0";
      }
      //btn.setAttribute('style', 'width:100px;height:30px;position:' + pos + ';left:50%;margin-left:-50px;' + location + ":0");
    } else {
      btn.style.top = "50%";
      btn.style.marginTop = "-47px"
      btn.style.left = "";
      btn.style.marginLeft = "";
      if (location == "left") {
        btn.style.left = "0";
      } else {
        btn.style.right = "0";
      }
      //btn.setAttribute('style', 'width:100px;height:30px;position:' + pos + ';top:50%;margin-top:-15px;' + location + ":0");
    }
    setTextArea();    
  }

  function setPosition(pos) {
    btn = document.getElementById("affButton");
    btn.style.position = pos;
    setTextArea();
  }

  function setTextArea() {
    btn = document.getElementById("affButton");
    wrap = document.createElement('div');
    wrap.appendChild(btn.cloneNode(true));
    document.getElementById('area').value = wrap.innerHTML;
  }
  $(document).ready(function() {
    setTextArea();
    cancelColour = '<%=@widget_profile.tickets_background%>';
  
    $("#colourChooser").spectrum({
        color: "<%=@widget_profile.tickets_background%>",
        preferredFormat: "hex",
        clickoutFiresChange: true,
        move: function(colour) {
          document.getElementById("ticket_widget").style.background = colour.toHexString();
        },
        change: function(colour) {
          cancelColour = colour;
          formdata = new FormData();
          formdata.append("tickets_background", colour);
          cancels = document.getElementsByClassName("sp-cancel");
          cancels[0].setAttribute("onclick", 'document.getElementById("ticket_widget").style.background = "' + cancelColour + '"');

          $.ajax({
            url: "<%= widget_profile_path(@widget_profile)%>",
            type: "PUT",
            data: formdata,
            "dataType":"json",
            processData: false,
            contentType: false
          });
        }
    });   


    cancelEventColour = '<%=@widget_profile.events_background%>';
  
    $("#eventColour").spectrum({
        color: "<%=@widget_profile.events_background%>",
        preferredFormat: "hex",
        clickoutFiresChange: true,
        move: function(colour) {
          $('.eventColourChange').css("background", colour.toHexString());
        },
        change: function(colour) {
          cancelEventColour = colour.toHexString();
          formdata = new FormData();
          formdata.append("events_background", colour.toHexString());

          cancels = document.getElementsByClassName("sp-cancel");
          cancels[1].setAttribute("onclick", "$('.eventColourChange').css('background', '" + cancelEventColour + "')");

          $.ajax({
            url: "<%= widget_profile_path(@widget_profile)%>",
            type: "PUT",
            data: formdata,
            "dataType":"json",
            processData: false,
            contentType: false
          });
        }
    });

    cancels = document.getElementsByClassName("sp-cancel");
    cancels[0].setAttribute("onclick", 'document.getElementById("ticket_widget").style.background = "' + cancelColour + '"');
    cancels[1].setAttribute("onclick", "$('.eventColourChange').css('background', '" + cancelEventColour + "')");
  })

</script>
